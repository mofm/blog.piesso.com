<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Ignotum Per Ignotius">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>hardened .*(nt|log)s?</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="canonical" href="https://blog.piesso.com/">
<link rel="icon" href="images/website/favicon.ico" sizes="16x16">
<link rel="icon" href="images/website/favicon-32x32.png" sizes="32x32">
<link rel="icon" href="images/website/favicon-16x16.png" sizes="16x16">
<link rel="icon" href="images/website/apple-touch-icon.png" sizes="180x180">
<link rel="icon" href="images/website/android-chrome-512x512.png" sizes="512x512">
<link rel="icon" href="images/website/android-chrome-192x192.png" sizes="192x192">
<link rel="next" href="index-24.html" type="text/html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="prefetch" href="posts/tinit-tiny-init-for-microvm/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark
bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href=".">

            <span id="blog-title">hardened .*(nt|log)s?</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="#" class="nav-link">Home</a>
                </li>
<li class="nav-item">
<a href="archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="pages/about-me" class="nav-link">About me</a>
                </li>
<li class="nav-item">
<a href="https://github.com/mofm" class="nav-link">Github</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        

    


    
<div class="postindex">
    <article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/tinit-tiny-init-for-microvm/" class="u-url">tinit - tiny init for microvm</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                mofm
            </span></p>
            <p class="dateline">
            <a href="posts/tinit-tiny-init-for-microvm/" rel="bookmark">
            <time class="published dt-published" datetime="2022-12-24T23:22:15+03:00" itemprop="datePublished" title="2022-12-24 23:22">2022-12-24 23:22</time></a>
            </p>
                <p class="commentline">
    
        <a href="posts/tinit-tiny-init-for-microvm/#utterances-thread">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <p>tinit, a tiny but valid init for microvm</p>
<p><a href="https://github.com/mofm/tinit">Github repo</a></p>
<h3>What is tinit?</h3>
<p>tinit, basic and tiny init for microvm, it's a valid init, but it's not a full init, it's just a simple init, it's not a replacement for systemd, it's just a simple init for microvm.</p>
<ul>
<li>It mounts required filesystems.</li>
<li>It configures the network.</li>
<li>It configures the hostname.</li>
<li>It runs the user specified command.</li>
</ul>
<h3>Compile from source</h3>
<ul>
<li>You need to install the following packages:</li>
<li><code>make</code></li>
<li><code>gcc</code></li>
<li>
<p><code>git</code></p>
</li>
<li>
<p>Clone the repository:</p>
</li>
</ul>
<pre class="code literal-block">git clone https://github.com/mofm/tinit.git
</pre>
<ul>
<li>You can edit the <code>Makefile</code> to change the installation directory or CFLAGS or etc.</li>
<li>Compile:</li>
</ul>
<pre class="code literal-block">make
</pre>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/mv-kernel-kernel-build-tool-for-microvm/" class="u-url">mv-kernel - kernel build tool for microvm</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                mofm
            </span></p>
            <p class="dateline">
            <a href="posts/mv-kernel-kernel-build-tool-for-microvm/" rel="bookmark">
            <time class="published dt-published" datetime="2022-12-24T23:14:00+03:00" itemprop="datePublished" title="2022-12-24 23:14">2022-12-24 23:14</time></a>
            </p>
                <p class="commentline">
    
        <a href="posts/mv-kernel-kernel-build-tool-for-microvm/#utterances-thread">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <p>mv-kernel, kernel configuration, build tool for micro virtual machine.</p>
<p><a href="https://github.com/mofm/mv_kernel">Github repo</a></p>
<h3>1. Quick Start</h3>
<p>mv-kernel, fast way to build kernel for micro virtual machine.</p>
<h4>1.1. Clone mv-kernel</h4>
<pre class="code literal-block">$ git clone https://github.com/mofm/mv-kernel.git
$ <span class="nb">cd</span> mv-kernel
</pre>
<h4>1.2. Build</h4>
<p>Download kernel source code, and build kernel.</p>
<pre class="code literal-block">$ make all
</pre>
<p>Finally, you can find the kernel image in <code>images</code> directory.</p>
<h3>2. All target of Makefile</h3>
<ul>
<li>Only download and exract kernel source code.</li>
</ul>
<pre class="code literal-block">$ make download
</pre>
<ul>
<li>Configure kernel.</li>
</ul>
<pre class="code literal-block">$ make config
</pre>
<ul>
<li>Build kernel.</li>
</ul>
<pre class="code literal-block">$ make build
</pre>
<ul>
<li>Download and extract kernel source code, configure kernel, build kernel. Execute all target.(download + config + build)</li>
</ul>
<pre class="code literal-block">$ make all
</pre>
<ul>
<li>Clean kernel source code for reconfigure and rebuild.(soft clean)</li>
</ul>
<pre class="code literal-block">$ make clean
</pre>
<ul>
<li>Clean all build files, kernel directory and kernel images.(hard clean)</li>
</ul>
<pre class="code literal-block">$ make clean-all
</pre>
<ul>
<li>Help</li>
</ul>
<pre class="code literal-block">$ make <span class="nb">help</span>
</pre>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/meta-econ-openembeddedyocto-layer/" class="u-url">meta-econ - openembedded/yocto layer</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                mofm
            </span></p>
            <p class="dateline">
            <a href="posts/meta-econ-openembeddedyocto-layer/" rel="bookmark">
            <time class="published dt-published" datetime="2022-12-24T23:08:50+03:00" itemprop="datePublished" title="2022-12-24 23:08">2022-12-24 23:08</time></a>
            </p>
                <p class="commentline">
    
        <a href="posts/meta-econ-openembeddedyocto-layer/#utterances-thread">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <p>meta-econ, OpenEmbedded/Yocto layer for minimal systemd-nspawn containers. (E-Con Linux Distribution)</p>
<p><a href="https://github.com/mofm/meta-econ">Github repo</a></p>
<h2>e-Con Linux Distribution</h2>
<p>e-Con Linux is an embedded Linux Distribution optimized for systemd-nspawn containers. It is built on OpenEmbedded. This distribution is focus on minimal and slim container image.</p>
<p>There are two different core image:</p>
<ul>
<li>e-Con Tiny Core Image</li>
<li>e-Con Core Image</li>
</ul>
<h3>e-Con Tiny Core Image</h3>
<p>e-Con Tiny Core Image is really so tiny. It's built with musl and busybox. It works successfully with systemd-nspawn. Tested!
<em>(Recommended)</em></p>
<p>e-Con Tiny Core Image packages:</p>
<pre class="code literal-block">base-files
busybox
busybox-inittab
init-ifupdown
libattr1
musl
netbase
os-release
packagegroup-core-boot
shadow-base
shadow-securetty
util-linux-sulogin
</pre>
<p>compressed rootfs size: ~660 KB :)
uncompressed rootfs size: ~1.2 MB</p>
<h3>e-Con Core Image</h3>
<p>e-Con Core Image size is larger than e-Con Tiny Core. It is built with glibc and systemd. Natively, actually systemd-nspawn only supports systemd. So it is built with systemd.</p>
<p>e-Con Core Image packages:</p>
<pre class="code literal-block"><span class="n">base</span><span class="o">-</span><span class="n">files</span>
<span class="n">busybox</span>
<span class="n">dbus</span><span class="o">-</span><span class="mi">1</span>
<span class="n">dbus</span><span class="o">-</span><span class="n">common</span>
<span class="n">dbus</span><span class="o">-</span><span class="n">tools</span>
<span class="n">kmod</span>
<span class="n">libacl1</span>
<span class="n">libattr1</span>
<span class="n">libblkid1</span>
<span class="n">libc6</span>
<span class="n">libcap</span>
<span class="n">libcrypt2</span>
<span class="n">libdbus</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="mi">3</span>
<span class="n">libexpat1</span>
<span class="n">libkmod2</span>
<span class="n">liblzma5</span>
<span class="n">libmount1</span>
<span class="n">libnss</span><span class="o">-</span><span class="n">myhostname2</span>
<span class="n">libsystemd0</span>
<span class="n">libz1</span>
<span class="n">netbase</span>
<span class="n">os</span><span class="o">-</span><span class="n">release</span>
<span class="n">packagegroup</span><span class="o">-</span><span class="n">core</span><span class="o">-</span><span class="n">boot</span>
<span class="n">shadow</span><span class="o">-</span><span class="n">base</span>
<span class="n">shadow</span><span class="o">-</span><span class="n">securetty</span>
<span class="n">systemd</span>
<span class="n">systemd</span><span class="o">-</span><span class="n">compat</span><span class="o">-</span><span class="n">units</span>
<span class="n">systemd</span><span class="o">-</span><span class="n">serialgetty</span>
<span class="n">systemd</span><span class="o">-</span><span class="n">udev</span><span class="o">-</span><span class="n">rules</span>
<span class="n">systemd</span><span class="o">-</span><span class="n">vconsole</span><span class="o">-</span><span class="n">setup</span>
<span class="n">udev</span>
<span class="n">util</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">agetty</span>
<span class="n">util</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">fsck</span>
<span class="n">util</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">mount</span>
<span class="n">util</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">sulogin</span>
<span class="n">util</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">umount</span>
<span class="n">volatile</span><span class="o">-</span><span class="n">binds</span>
</pre>
<p>But even so its compressed rootfs size: 4.9 MB
uncompressed size: ~17MB</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/nspctl-management-tool-for-systemd-nspawn-containers/" class="u-url">nspctl for systemd-nspawn containers</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                mofm
            </span></p>
            <p class="dateline">
            <a href="posts/nspctl-management-tool-for-systemd-nspawn-containers/" rel="bookmark">
            <time class="published dt-published" datetime="2022-12-24T23:04:28+03:00" itemprop="datePublished" title="2022-12-24 23:04">2022-12-24 23:04</time></a>
            </p>
                <p class="commentline">
    
        <a href="posts/nspctl-management-tool-for-systemd-nspawn-containers/#utterances-thread">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <p>nspctl, management tool for systemd-nspawn containers.</p>
<p><a class="reference external" href="https://github.com/mofm/nspctl">Github repo</a></p>
<section id="why-nspctl"><h2>Why nspctl?</h2>
<p>There are different tools for systemd-nspawn containers. You can use native tools ('machinectl' command) to manage for containers.
But systemd-nspawn, machinectl or other tools do not support non-systemd containers.
(non-systemd containers: containers with another init system from systemd. Such as systemv, openrc, upstart, busybox init, etc.)</p>
<p>nspctl supports containers with any init system. nspctl provides almost all of the features that machinectl provides.</p>
<p><strong>Currently implemented features are:</strong></p>
<ul class="simple">
<li>
<p>Lists</p>
<ul>
<li><p>running containers</p></li>
<li><p>stopped containers</p></li>
<li><p>all containers</p></li>
</ul>
</li>
<li><p>Containers info</p></li>
<li><p>Containers status</p></li>
<li><p>Start the container</p></li>
<li><p>Stop the container</p></li>
<li><p>Reboot the container</p></li>
<li><p>Remove the container</p></li>
<li><p>Enable the container (the container to be launched at boot)</p></li>
<li><p>Disable the container at startup</p></li>
<li><p>Copy files from host in to a container</p></li>
<li><p>Login the container shell</p></li>
<li><p>Pull and register containers(raw, tar and docker images)</p></li>
<li><p>Bootstrap <strong>Debian</strong> container ("jessie" and newer are supported)</p></li>
<li><p>Bootstrap <strong>Ubuntu</strong> container ("xenial" and newer are supported)</p></li>
<li><p>Bootstrap <strong>Arch Linux</strong> container</p></li>
<li><p>Bootstrap <strong>Alpine Linux</strong> container("v3.13" and newer are supported)</p></li>
<li><p>Remove hidden VM or container images</p></li>
<li><p>Remove all VM and container images</p></li>
<li><p>Run a new command in a running container (non-interactive shell)</p></li>
<li><p>Renames a container or VM image</p></li>
<li><p>import raw, tar and directory container images</p></li>
</ul></section><section id="installation"><h2>Installation</h2>
<section id="requirements"><h3>Requirements:</h3>
<ul class="simple">
<li><p>Python &gt;=3.8</p></li>
</ul></section><section id="dependencies"><h3>Dependencies:</h3>
<ul class="simple">
<li><p>systemd-container package</p></li>
</ul>
<p>For Debian and Ubuntu:</p>
<pre class="code text"><a id="rest_code_d145ef8e8621468bb3a11d62b9c9517d-1" name="rest_code_d145ef8e8621468bb3a11d62b9c9517d-1"></a>$ apt-get install systemd-container
</pre>
<p>For Centos, Fedora or Redhat Based Distributions:</p>
<pre class="code text"><a id="rest_code_3509790b145b4b499f36f98870fbda9a-1" name="rest_code_3509790b145b4b499f36f98870fbda9a-1"></a>$ yum install systemd-container
</pre>
<p>or</p>
<pre class="code text"><a id="rest_code_94a561a531344ff8a2e43c0e3947f1d5-1" name="rest_code_94a561a531344ff8a2e43c0e3947f1d5-1"></a>$ dnf install systemd-container
</pre>
<aside class="admonition note"><p class="admonition-title">Note</p>
<p>Gentoo with systemd and Arch Linux users don't need to install any packages.</p>
</aside></section><section id="install"><h3>Install:</h3>
<p><strong>From Github:</strong></p>
<ul class="simple">
<li><p>Clone this repository:</p></li>
</ul>
<pre class="code text"><a id="rest_code_c6f9fa0b7ecf44a68b845bec0d308e68-1" name="rest_code_c6f9fa0b7ecf44a68b845bec0d308e68-1"></a>$ git clone https://github.com/mofm/nspctl
</pre>
<ul class="simple">
<li><p>and install via pip:</p></li>
</ul>
<pre class="code text"><a id="rest_code_2a811e6a6df54cf79e6cd83d6dd8ef0a-1" name="rest_code_2a811e6a6df54cf79e6cd83d6dd8ef0a-1"></a>$ pip install nspctl/
</pre>
<p>If you would like to install for your user:</p>
<pre class="code text"><a id="rest_code_25c948c7e5bf40908ce5a2fe641dad19-1" name="rest_code_25c948c7e5bf40908ce5a2fe641dad19-1"></a>$ pip install --user nspctl/
</pre>
<p>and you need to add '.local/bin' directory to your path</p>
<pre class="code text"><a id="rest_code_e975af2a847349dfa395e4fb92685304-1" name="rest_code_e975af2a847349dfa395e4fb92685304-1"></a>$ export PATH="~/.local/bin/:$PATH"
</pre></section></section><section id="usage"><h2>Usage:</h2>
<p><strong>Synopsis:</strong></p>
<pre class="code text"><a id="rest_code_7e57a7edfda643cebfc7a5dc2606c8b8-1" name="rest_code_7e57a7edfda643cebfc7a5dc2606c8b8-1"></a>nspctl [ arguments ] [ options ] [ container name | URL | distribution ] [ ... ]
</pre>
<section id="commands"><h3>Commands:</h3>
<ul class="simple">
<li><p><em>list</em> : List currently running (online) containers.</p></li>
</ul>
<pre class="code text"><a id="rest_code_806b9b84a233495295a8f53321bbe4b1-1" name="rest_code_806b9b84a233495295a8f53321bbe4b1-1"></a>$ nspctl list
</pre>
<ul class="simple">
<li><p><em>list-stopped</em> : List stopped containers.( shortopts: 'lss')</p></li>
</ul>
<pre class="code text"><a id="rest_code_ae49f15aa83a4db492f8a94c000fdaf8-1" name="rest_code_ae49f15aa83a4db492f8a94c000fdaf8-1"></a>$ nspctl list-stopped
<a id="rest_code_ae49f15aa83a4db492f8a94c000fdaf8-2" name="rest_code_ae49f15aa83a4db492f8a94c000fdaf8-2"></a>$ nspctl lss
</pre>
<ul class="simple">
<li><p><em>list-running</em> : List currently running containers.(alias: 'list', shortopt: 'lsr')</p></li>
</ul>
<pre class="code text"><a id="rest_code_3a21273c50354e46b64db2c9002cf687-1" name="rest_code_3a21273c50354e46b64db2c9002cf687-1"></a>$ nspctl list-running
<a id="rest_code_3a21273c50354e46b64db2c9002cf687-2" name="rest_code_3a21273c50354e46b64db2c9002cf687-2"></a>$ nspctl lsr
</pre>
<ul class="simple">
<li><p><em>list-all</em> : List all containers.(shortopt: 'lsa')</p></li>
</ul>
<pre class="code text"><a id="rest_code_e12535d676ff4adda8000b9a3cccdb0e-1" name="rest_code_e12535d676ff4adda8000b9a3cccdb0e-1"></a>$ nspctl list-all
<a id="rest_code_e12535d676ff4adda8000b9a3cccdb0e-2" name="rest_code_e12535d676ff4adda8000b9a3cccdb0e-2"></a>$ nspctl lsa
</pre>
<ul class="simple">
<li><p><em>info NAME</em> : Show properties of container.</p></li>
</ul>
<pre class="code text"><a id="rest_code_4b6d514c336b4aafb508f8665a3aad58-1" name="rest_code_4b6d514c336b4aafb508f8665a3aad58-1"></a>$ nspctl info ubuntu-20.04
</pre>
<ul class="simple">
<li><p><em>start NAME</em> : Start a container as system service.</p></li>
</ul>
<pre class="code text"><a id="rest_code_3482fc77cb7d4445a5317e25e7bfb409-1" name="rest_code_3482fc77cb7d4445a5317e25e7bfb409-1"></a>$ nspctl start ubuntu-20.04
</pre>
<ul class="simple">
<li><p><em>reboot NAME</em> : Reboot a container.</p></li>
</ul>
<pre class="code text"><a id="rest_code_713ecb5a9b3444e0820fcf1ca9d0e9af-1" name="rest_code_713ecb5a9b3444e0820fcf1ca9d0e9af-1"></a>$ nspctl reboot ubuntu-20.04
</pre>
<ul class="simple">
<li><p><em>stop NAME</em> : Stop a container. Shutdown cleanly.(alias: 'poweroff')</p></li>
</ul>
<pre class="code text"><a id="rest_code_25c7168e7c894bf398f898b8a5735cb1-1" name="rest_code_25c7168e7c894bf398f898b8a5735cb1-1"></a>$ nspctl stop ubuntu-20.04
</pre>
<ul class="simple">
<li><p><em>terminate NAME</em> : Immediately terminates container without cleanly shutting it down.</p></li>
</ul>
<pre class="code text"><a id="rest_code_3edc4b7ee4794ba9b45b7fa7bd758bc6-1" name="rest_code_3edc4b7ee4794ba9b45b7fa7bd758bc6-1"></a>$ nspctl terminate ubuntu-20.04
</pre>
<ul class="simple">
<li><p><em>poweroff NAME</em> : Poweroff a container. Shutdown cleanly.</p></li>
</ul>
<pre class="code text"><a id="rest_code_9ce502ff46be4648b4a7629a5d5c9ecc-1" name="rest_code_9ce502ff46be4648b4a7629a5d5c9ecc-1"></a>$ nspctl poweroff ubuntu-20.04
</pre>
<ul class="simple">
<li><p><em>enable NAME</em> : Enable a container as a system service at system boot.</p></li>
</ul>
<pre class="code text"><a id="rest_code_cc0e34116ba94b04b869ecd5330f5078-1" name="rest_code_cc0e34116ba94b04b869ecd5330f5078-1"></a>$ nspctl enable ubuntu-20.04
</pre>
<ul class="simple">
<li><p><em>disable NAME</em> : Disable a container as a system service at system boot.</p></li>
</ul>
<pre class="code text"><a id="rest_code_e1af7575620b40c2bbc60c6616eb6be6-1" name="rest_code_e1af7575620b40c2bbc60c6616eb6be6-1"></a>$ nspctl disable ubuntu-20.04
</pre>
<ul class="simple">
<li><p><em>remove NAME</em> : Remove a container completely.</p></li>
</ul>
<pre class="code text"><a id="rest_code_bedda7d4a77d494faaff7e18a987898f-1" name="rest_code_bedda7d4a77d494faaff7e18a987898f-1"></a>$ nspctl remove ubuntu-20.04
</pre>
<ul class="simple">
<li><p><em>shell NAME</em> : Open an interactive shell session in a container.</p></li>
</ul>
<pre class="code text"><a id="rest_code_768dde8099eb482b866aca710ad7a542-1" name="rest_code_768dde8099eb482b866aca710ad7a542-1"></a>$ nspctl shell ubuntu-20.04
</pre>
<ul class="simple">
<li><p><em>copy-to NAME SOURCE DESTINATION</em> : Copies files from the host system into a running container.</p></li>
</ul>
<pre class="code text"><a id="rest_code_bc15ef76a8f14e129679c537f2bf12e4-1" name="rest_code_bc15ef76a8f14e129679c537f2bf12e4-1"></a>$ nspctl copy-to ubuntu-20.04 /home/hostuser/magicfile /home/containeruser/
</pre>
<ul class="simple">
<li><p><em>clean</em> : Remove hidden VM or container images. This command removes all hidden machine images from /var/lib/machines/.</p></li>
</ul>
<pre class="code text"><a id="rest_code_48d428104dd545b9bc7fff4efb2225ce-1" name="rest_code_48d428104dd545b9bc7fff4efb2225ce-1"></a>$ nspctl clean
</pre>
<ul class="simple">
<li><p><em>clean-all</em> : Remove all VM or container images. This command removes all machine images from /var/lib/machines/.</p></li>
</ul>
<pre class="code text"><a id="rest_code_26d55a00de6f4b53a1277d2215c39840-1" name="rest_code_26d55a00de6f4b53a1277d2215c39840-1"></a>$ nspctl clean-all
</pre>
<ul class="simple">
<li><p><em>exec NAME 'COMMAND'</em> : Runs a new command in a running container.</p></li>
</ul>
<pre class="code text"><a id="rest_code_2529c89bff2448c791a9c216e13ad4b0-1" name="rest_code_2529c89bff2448c791a9c216e13ad4b0-1"></a>$ nspctl exec ubuntu-20.04 'cat /etc/os-release'
</pre>
<ul class="simple">
<li><p><em>rename NAME NEWNAME</em> : Renames a container or VM image.</p></li>
</ul>
<pre class="code text"><a id="rest_code_35b00f7c7dd64762b11447afd7beb4d2-1" name="rest_code_35b00f7c7dd64762b11447afd7beb4d2-1"></a>$ nspctl rename ubuntu-20.04 ubuntu-newimage
</pre>
<ul class="simple">
<li><p><em>usage</em> : nspctl usage page</p></li>
</ul>
<pre class="code text"><a id="rest_code_e8888edf963b4bf396f904392af4575d-1" name="rest_code_e8888edf963b4bf396f904392af4575d-1"></a>$ nspctl usage
</pre>
<ul class="simple">
<li><p><em>--help</em> : display help page and exit</p></li>
</ul>
<pre class="code text"><a id="rest_code_95d0ba96ce8d41969cd51cd07632c0d2-1" name="rest_code_95d0ba96ce8d41969cd51cd07632c0d2-1"></a>$ nspctl --help or -h
</pre></section><section id="container-operations"><h3>Container Operations:</h3>
<ul class="simple">
<li><p><em>pull-tar URL NAME</em> : Downloads a .tar container image from the specified URL.(tar, tar.gz, tar.xz, tar.bz2)</p></li>
</ul>
<pre class="code text"><a id="rest_code_dd295c95e463405eba55851f97cc8bd5-1" name="rest_code_dd295c95e463405eba55851f97cc8bd5-1"></a>$ nspctl pull-tar https://github.com/mofm/meta-econ/releases/download/v0.3.0-r2/econ-tiny-nginx-20220123-qemux86-64.tar.xz econ-nginx
</pre>
<ul class="simple">
<li><p><em>pull-raw URL NAME</em> : Downloads a .raw container from the specified URL.(qcow2 or compressed as gz, xz, bz2)</p></li>
</ul>
<pre class="code text"><a id="rest_code_5cc39d451f184f6db8dbf0d899dbe106-1" name="rest_code_5cc39d451f184f6db8dbf0d899dbe106-1"></a>$ nspctl pull-raw https://download.fedoraproject.org/pub/fedora/linux/releases/35/Cloud/x86_64/images/Fedora-Cloud-Base-35-1.2.x86_64.raw.xz fedora-cloud-base-35
</pre>
<ul class="simple">
<li><p><em>import-raw IMAGE NAME</em> : Execute a <code class="docutils literal">machinectl <span class="pre">import-raw</span></code> to import a .qcow2 or raw disk image.</p></li>
</ul>
<pre class="code text"><a id="rest_code_722c8d74db204e979c8de59eb0395cc1-1" name="rest_code_722c8d74db204e979c8de59eb0395cc1-1"></a>$ nspctl import-raw Fedora-Cloud-Base-35-1.2.x86_64.raw.xz fedora-cloud-base-35
</pre>
<ul class="simple">
<li><p><em>import-tar IMAGE NAME</em> : Execute a <code class="docutils literal">machinectl <span class="pre">import-tar</span></code> to import a .tar container image.</p></li>
</ul>
<pre class="code text"><a id="rest_code_cfdc56a042774242a5e2eac2a8350a8b-1" name="rest_code_cfdc56a042774242a5e2eac2a8350a8b-1"></a>$ nspctl import-tar econ-tiny-nginx-20220123-qemux86-64.tar.xz econ-nginx
</pre>
<ul class="simple">
<li><p><em>import-fs DIRECTORY NAME</em> : Execute a <code class="docutils literal">machinectl <span class="pre">import-fs</span></code> to import a directory image.</p></li>
</ul>
<pre class="code text"><a id="rest_code_4260614f1b4841fabffb1a9a29407955-1" name="rest_code_4260614f1b4841fabffb1a9a29407955-1"></a>$ nspctl import-fs econ-tiny-nginx-20220123 econ-httpd
</pre>
<ul class="simple">
<li><p><em>bootstrap NAME DIST VERSION</em> : Bootstrap a container from package servers. Supported Distributions are Debian, Ubuntu, Arch Linux and Alpine Linux.</p></li>
</ul>
<pre class="code text"><a id="rest_code_f2086fdcb5324663b2b104caf548b9dd-1" name="rest_code_f2086fdcb5324663b2b104caf548b9dd-1"></a>$ nspctl bootstrap alpine-3.15 alpine latest-stable
<a id="rest_code_f2086fdcb5324663b2b104caf548b9dd-2" name="rest_code_f2086fdcb5324663b2b104caf548b9dd-2"></a>$ nspctl bootstrap ubuntu-20.04 ubuntu focal
<a id="rest_code_f2086fdcb5324663b2b104caf548b9dd-3" name="rest_code_f2086fdcb5324663b2b104caf548b9dd-3"></a>$ nspctl bootstrap debian-latest debian stable
<a id="rest_code_f2086fdcb5324663b2b104caf548b9dd-4" name="rest_code_f2086fdcb5324663b2b104caf548b9dd-4"></a>$ nspctl bootstrap arch-test arch
</pre></section></section>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/bohca-yet-another-bookmanager/" class="u-url">bohca - yet another bookmanager</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                mofm
            </span></p>
            <p class="dateline">
            <a href="posts/bohca-yet-another-bookmanager/" rel="bookmark">
            <time class="published dt-published" datetime="2022-12-24T22:54:15+03:00" itemprop="datePublished" title="2022-12-24 22:54">2022-12-24 22:54</time></a>
            </p>
                <p class="commentline">
    
        <a href="posts/bohca-yet-another-bookmanager/#utterances-thread">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <h2>Introduction</h2>
<p>This is a simple bookmark manager for the web. It keeps your favorites books, articles, songs or whatever else you come across while browsing and allows you to search them.</p>
<p>The project is written with django 4.1 and Python 3.9. </p>
<p><a href="https://github.com/mofm/bohca">Github repo</a></p>
<h4>Features</h4>
<ul>
<li>Simple and intuitive interface</li>
<li>Bootstrap 4 (static files included)</li>
<li>Procfile for deployment</li>
<li>SQLite database by default</li>
<li>Search by title, description, links and tags</li>
<li>Separate settings for development and production(environment variables)</li>
<li>Add, edit and delete bookmarks, tags and categories</li>
<li>Backup bookmarks to CSV</li>
<li>Restore bookmarks from CSV</li>
<li>Export bookmarks to HTML (Firefox and Chrome compatible - <em>tested</em>)</li>
<li>Custom admin interface, with search and filters (view, edit, delete all bookmarks, tags and categories)</li>
</ul>
<h4>Roadmap</h4>
<ul>
<li><del>Backup and restore bookmarks</del></li>
<li><del>Export bookmarks for browsers</del></li>
<li>Browser extension (Chrome, Firefox, Safari)</li>
</ul>
<h4>Installation</h4>
<ul>
<li>Create a virtual environment and activate it</li>
</ul>
<pre class="code literal-block">python3 -m venv bohca-venv
<span class="nb">source</span> bohca-venv/bin/activate
</pre>
<ul>
<li>Clone the repository</li>
</ul>
<pre class="code literal-block">git clone https://github.com/mofm/bohca.git
</pre>
<ul>
<li>Install the requirements</li>
</ul>
<pre class="code literal-block">pip install -r requirements.txt
</pre>
<ul>
<li>Freeze requirements</li>
</ul>
<pre class="code literal-block">pip freeze &gt; requirements.txt
</pre>
<ul>
<li>Create environment files</li>
</ul>
<pre class="code literal-block">mkdir .env
touch .env/development.env
touch .env/production.env
</pre>
<ul>
<li>Add the following variables to 'development.env' file</li>
</ul>
<p>For production environment, use environment variables from 'production.env' file</p>
<pre class="code literal-block"><span class="nv">DEBUG</span><span class="o">=</span><span class="s2">"True"</span>
<span class="nv">SECRET_KEY</span><span class="o">=</span>your_secret_key
<span class="nv">ALLOWED_HOSTS</span><span class="o">=</span> <span class="s2">"127.0.0.1, localhost"</span>
</pre>
<ul>
<li>Run the migrations</li>
</ul>
<pre class="code literal-block">python manage.py makemigrations
python manage.py migrate --run-syncdb
</pre>
<ul>
<li>Create a superuser</li>
</ul>
<pre class="code literal-block">python manage.py createsuperuser
</pre>
<ul>
<li>Collect static files</li>
</ul>
<pre class="code literal-block">python manage.py collectstatic
</pre>
<ul>
<li>You can test out the application by running the following command:</li>
</ul>
<pre class="code literal-block">python manage.py runserver <span class="m">0</span>.0.0.0:8000
</pre>
<ul>
<li>Open your browser and go to http://localhost:8000</li>
</ul>
<h4>Deployment</h4>
<ul>
<li>Install gunicorn</li>
</ul>
<pre class="code literal-block">pip install gunicorn
</pre>
<ul>
<li>Create gunicorn systemd service files for production environment</li>
</ul>
<pre class="code literal-block">sudo vi  /etc/systemd/system/gunicorn.service
</pre>
<ul>
<li>Add the following content to the 'gunicorn.service' file</li>
</ul>
<pre class="code literal-block"><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>gunicorn daemon
<span class="nv">After</span><span class="o">=</span>network.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Type</span><span class="o">=</span>notify
<span class="nv">User</span><span class="o">=</span>user
<span class="nv">Group</span><span class="o">=</span>user
<span class="nv">EnvironmentFile</span><span class="o">=</span>/path/to/bohca_venv/bohca/.env/production.env
<span class="nv">WorkingDirectory</span><span class="o">=</span>/path/to/bohca_venv/bohca
<span class="nv">ExecStart</span><span class="o">=</span>/path/to/bohca_venv/bin/gunicorn --workers <span class="m">3</span> --bind <span class="m">0</span>.0.0.0:8000 bohca.wsgi:application
<span class="nv">ExecReload</span><span class="o">=</span>/bin/kill -s HUP <span class="nv">$MAINPID</span>
<span class="nv">KillMode</span><span class="o">=</span>mixed
<span class="nv">TimeoutStopSec</span><span class="o">=</span><span class="m">5</span>
<span class="nv">PrivateTmp</span><span class="o">=</span><span class="nb">true</span>

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre>
<ul>
<li>Start the gunicorn service</li>
</ul>
<pre class="code literal-block">sudo systemctl start gunicorn
</pre>
<ul>
<li>Enable the gunicorn service</li>
</ul>
<pre class="code literal-block">sudo systemctl <span class="nb">enable</span> gunicorn
</pre>
<ul>
<li>Check the status of the gunicorn service</li>
</ul>
<pre class="code literal-block">sudo systemctl status gunicorn
</pre>
<ul>
<li>Create nginx configuration file for production environment</li>
</ul>
<pre class="code literal-block">sudo vi /etc/nginx/sites-available/bohca
</pre>
<ul>
<li>Add the following content to the bohca file</li>
</ul>
<pre class="code literal-block">server <span class="o">{</span>
    listen <span class="m">80</span><span class="p">;</span>
    server_name your_domain_name<span class="p">;</span>

    <span class="nv">location</span> <span class="o">=</span> /favicon.ico <span class="o">{</span> access_log off<span class="p">;</span> log_not_found off<span class="p">;</span> <span class="o">}</span>
    location /static/ <span class="o">{</span>
        root /path/to/bohca_venv/bohca/staticfiles<span class="p">;</span>
    <span class="o">}</span>

    location / <span class="o">{</span>
        include proxy_params<span class="p">;</span>
        <span class="c1"># proxy_pass gunicorn_socket or http://;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre>
<ul>
<li>Enable the bohca configuration file</li>
</ul>
<pre class="code literal-block">sudo ln -s /etc/nginx/sites-available/bohca /etc/nginx/sites-enabled
</pre>
<ul>
<li>Test the nginx configuration file</li>
</ul>
<pre class="code literal-block">sudo nginx -t
</pre>
<ul>
<li>Restart the nginx service</li>
</ul>
<pre class="code literal-block">sudo systemctl restart nginx
</pre>
<ul>
<li>Check the status of the nginx service</li>
</ul>
<pre class="code literal-block">sudo systemctl status nginx
</pre>
<h4>License</h4>
<p>GNU General Public License v3.0</p>
    </div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/feeder-rss-feed-reader/" class="u-url">feeder - RSS feed reader</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                mofm
            </span></p>
            <p class="dateline">
            <a href="posts/feeder-rss-feed-reader/" rel="bookmark">
            <time class="published dt-published" datetime="2022-12-24T22:50:57+03:00" itemprop="datePublished" title="2022-12-24 22:50">2022-12-24 22:50</time></a>
            </p>
                <p class="commentline">
    
        <a href="posts/feeder-rss-feed-reader/#utterances-thread">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <h2>Introduction</h2>
<p>The goal of this project is to create a simple, yet powerful, reader for RSS feeds. It reads RSS URLs in the feed.ini file and fetch the content of the feeds.</p>
<p>The project is written with django 4.1 and Python 3. </p>
<p><a href="https://github.com/mofm/feeder">Github repo</a></p>
<h4>Features</h4>
<ul>
<li>Simple and intuitive interface</li>
<li>Bootstrap 4 (static files included)</li>
<li>Procfile for deployment</li>
<li>SQLite database by default</li>
<li>Separate settings for development and production(environment variables)</li>
<li>Custom admin interface</li>
<li>User authentication and Permissions for viewing and editing feeds</li>
<li>Users add favorite feeds to their profile</li>
</ul>
<h3>Installation</h3>
<ul>
<li>Create a virtual environment and activate it</li>
</ul>
<pre class="code literal-block">python3 -m venv feeder-venv
<span class="nb">source</span> feeder-venv/bin/activate
</pre>
<ul>
<li>Clone the repository</li>
</ul>
<pre class="code literal-block">git clone https://github.com/mofm/feeder.git
</pre>
<ul>
<li>Install dependencies</li>
</ul>
<pre class="code literal-block">pip install -r requirements.txt
</pre>
<ul>
<li>Create environment files</li>
</ul>
<pre class="code literal-block">mkdir .env
touch .env/development.env
touch .env/production.env
</pre>
<ul>
<li>Add environment variables for your development environment</li>
</ul>
<p>For production environment, use environment variables from production.env</p>
<pre class="code literal-block"><span class="nv">SECRET_KEY</span><span class="o">=</span> <span class="o">(</span>generate a random string: create new secret key<span class="o">)</span>
<span class="nv">DEBUG</span><span class="o">=</span>False
<span class="nv">ALLOWED_HOSTS</span><span class="o">=</span><span class="m">127</span>.0.0.1 feeder.example.com
</pre>
<ul>
<li>Initial database schema and migrate</li>
</ul>
<pre class="code literal-block">python manage.py makemigrations
python manage.py migrate
python manage.py migrate --run-syncdb
</pre>
<ul>
<li>Create superuser</li>
</ul>
<pre class="code literal-block">python manage.py createsuperuser
</pre>
<ul>
<li>Collect static files</li>
</ul>
<pre class="code literal-block">python manage.py collectstatic
</pre>
<ul>
<li>You can test out the application by running the following command:</li>
</ul>
<pre class="code literal-block">python manage.py runserver <span class="m">0</span>.0.0.0:8000
</pre>
<h3>Deployment</h3>
<ul>
<li>Create gunicorn systemd service files for production environment</li>
</ul>
<pre class="code literal-block">sudo vi  /etc/systemd/system/gunicorn.service
</pre>
<pre class="code literal-block"><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>gunicorn daemon
<span class="nv">After</span><span class="o">=</span>network.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Type</span><span class="o">=</span>notify
<span class="nv">User</span><span class="o">=</span>user
<span class="nv">Group</span><span class="o">=</span>user
<span class="nv">EnvironmentFile</span><span class="o">=</span>/path/to/feeder_venv/feeder/.env/production.env
<span class="nv">WorkingDirectory</span><span class="o">=</span>/path/to/feeder_venv/feeder
<span class="nv">ExecStart</span><span class="o">=</span>/path/to/feeder_venv/bin/gunicorn --workers <span class="m">3</span> --bind <span class="m">0</span>.0.0.0:8000 feeder.wsgi:application
<span class="nv">ExecReload</span><span class="o">=</span>/bin/kill -s HUP <span class="nv">$MAINPID</span>
<span class="nv">KillMode</span><span class="o">=</span>mixed
<span class="nv">TimeoutStopSec</span><span class="o">=</span><span class="m">5</span>
<span class="nv">PrivateTmp</span><span class="o">=</span><span class="nb">true</span>

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre>
<ul>
<li>Create schedule jobs systemd service file for production environment</li>
</ul>
<p><em>This is used to check RSS URLs from feed.ini file and fetch new feeds every 2 minutes</em></p>
<pre class="code literal-block">sudo vi  /etc/systemd/system/schedule_jobs.service
</pre>
<pre class="code literal-block"><span class="o">[</span>Unit<span class="o">]</span>
<span class="nv">Description</span><span class="o">=</span>Feederjobs daemon
<span class="nv">After</span><span class="o">=</span>network.target

<span class="o">[</span>Service<span class="o">]</span>
<span class="nv">Type</span><span class="o">=</span>Simple
<span class="nv">User</span><span class="o">=</span>user
<span class="nv">Group</span><span class="o">=</span>user
<span class="nv">EnvironmentFile</span><span class="o">=</span>/path/to/feeder_venv/feeder/.env/production.env
<span class="nv">WorkingDirectory</span><span class="o">=</span>/path/to/feeder_venv/feeder
<span class="nv">ExecStart</span><span class="o">=</span>/path/to/feeder_venv/bin/python manage.py startjobs
<span class="nv">ExecReload</span><span class="o">=</span>/bin/kill -s HUP <span class="nv">$MAINPID</span>
<span class="nv">KillMode</span><span class="o">=</span>mixed
<span class="nv">TimeoutStopSec</span><span class="o">=</span><span class="m">5</span>
<span class="nv">PrivateTmp</span><span class="o">=</span><span class="nb">true</span>

<span class="o">[</span>Install<span class="o">]</span>
<span class="nv">WantedBy</span><span class="o">=</span>multi-user.target
</pre>
<ul>
<li>Start and enable gunicorn service</li>
</ul>
<pre class="code literal-block">sudo systemctl start gunicorn.service
sudo systemctl <span class="nb">enable</span> gunicorn.service
</pre>
<ul>
<li>
<p>Login to admin interface and create new category(Example: Tech)</p>
</li>
<li>
<p>Add new RSS URL to feed.ini file</p>
</li>
</ul>
<pre class="code literal-block">vi  /path/to/feeder_venv/feeder/feed.ini
</pre>
<pre class="code literal-block"><span class="o">[</span>EFF<span class="o">]</span>
<span class="nv">feed</span> <span class="o">=</span> https://www.eff.org/rss/updates.xml
<span class="nv">link</span> <span class="o">=</span> https://www.eff.org
<span class="nv">logo</span> <span class="o">=</span> https://www.eff.org/sites/all/themes/phoenix/images/logo-monogram.svg
<span class="nv">category</span> <span class="o">=</span> Tech
</pre>
<ul>
<li>Start and enable schedule jobs service</li>
</ul>
<pre class="code literal-block">sudo systemctl start schedule_jobs.service
sudo systemctl <span class="nb">enable</span> schedule_jobs.service
</pre>
<p>Finally, you can test out the application by browsing to http://localhost:8000/</p>
<h3>Notes</h3>
<ul>
<li>This is personal project. So It may have missing features.</li>
<li>You can create users and permissions for viewing and editing feeds via admin interface.(rssfeeder.view_feed)</li>
<li>Homepage shows the feeds in the default category. If category key doesn't exist or empty value in feed.ini section, it shows the feeds in the default category.</li>
<li>Four categories are Tech, Science, News and Videos hardcoded in the application 'url.py' file. But didn't create an object in categories for them. If you want to use them, you can create these categories in the admin interface.</li>
<li>You can add new categories in the admin interface. Also, you can add navbar.html file in the templates directory to customize the application.</li>
</ul>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/gentoo-zsh-completions-for-oh-my-zsh/" class="u-url">gentoo-zsh-completions for oh-my-zsh</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                mofm
            </span></p>
            <p class="dateline">
            <a href="posts/gentoo-zsh-completions-for-oh-my-zsh/" rel="bookmark">
            <time class="published dt-published" datetime="2022-01-05T17:50:47+03:00" itemprop="datePublished" title="2022-01-05 17:50">2022-01-05 17:50</time></a>
            </p>
                <p class="commentline">
    
        <a href="posts/gentoo-zsh-completions-for-oh-my-zsh/#utterances-thread">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <p>gentoo-zsh-completions plugin for oh-my-zsh. forked from gentoo-zsh-completions main repository,
and modified for Oh-my-zsh.</p>
<section id="installation"><h2>Installation:</h2>
<pre class="code bash"><a id="rest_code_7c4b0f0b58a546978e6cd4289806fd19-1" name="rest_code_7c4b0f0b58a546978e6cd4289806fd19-1"></a>$ git clone https://github.com/mofm/gentoo-zsh-completions.git <span class="si">${</span><span class="nv">ZSH_CUSTOM</span><span class="k">:-</span><span class="p">~/.oh-my-zsh/custom</span><span class="si">}</span>/plugins/gentoo-zsh-completions
</pre>
<p>To use it, add <em>'gentoo-zsh-completions'</em> to the plugins array in your zshrc file:</p>
<pre class="literal-block">plugins=(... gentoo-zsh-completions)</pre>
</section>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/gentoo-kernel-build-script/" class="u-url">Gentoo kernel build script</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                mofm
            </span></p>
            <p class="dateline">
            <a href="posts/gentoo-kernel-build-script/" rel="bookmark">
            <time class="published dt-published" datetime="2021-12-28T01:48:49+03:00" itemprop="datePublished" title="2021-12-28 01:48">2021-12-28 01:48</time></a>
            </p>
                <p class="commentline">
    
        <a href="posts/gentoo-kernel-build-script/#utterances-thread">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <p>Automating the kernel compile, configuration copying, systemd-boot and grub2 configuration updating, old kernel cleaning script for Gentoo Linux.</p>
<section id="usage"><h2>Usage:</h2>
<ul class="simple">
<li><p>First, clone this repository and change directory:</p></li>
</ul>
<pre class="code bash"><a id="rest_code_6eaecc0cb8a34cf78b9640ec4141e73e-1" name="rest_code_6eaecc0cb8a34cf78b9640ec4141e73e-1"></a>git clone https://github.com/mofm/kernel-build.git
<a id="rest_code_6eaecc0cb8a34cf78b9640ec4141e73e-2" name="rest_code_6eaecc0cb8a34cf78b9640ec4141e73e-2"></a><span class="nb">cd</span> kernel-build
</pre>
<ul class="simple">
<li><p>Change script permissons:</p></li>
</ul>
<pre class="code bash"><a id="rest_code_fc42576967d346b79fa0d307ae55a880-1" name="rest_code_fc42576967d346b79fa0d307ae55a880-1"></a>chmod +x build-kernel.sh
</pre>
<ul>
<li>
<p>If you are using systemd-boot you should first learn rootfs disk UUID or LVM partition and then add it to the script:</p>
<pre class="literal-block">UUID="dfc588c0-edd4-8543-a3fe-d7d49bd8f141"</pre>
</li>
</ul>
<p><strong>Optional:</strong> <em>You can add specific kernel parameters to ROOTFLAGS.</em></p>
<ul class="simple">
<li><p>Now you execute the script like so:</p></li>
</ul>
<pre class="code bash"><a id="rest_code_6ee8f83fdf794a9baa272057a1a13f46-1" name="rest_code_6ee8f83fdf794a9baa272057a1a13f46-1"></a>./build-kernel.sh systemd-boot
</pre>
<ul class="simple">
<li><p>If you are using <strong>grub2</strong>:</p></li>
</ul>
<pre class="code bash"><a id="rest_code_38d95a88162042a29de13feef84425ec-1" name="rest_code_38d95a88162042a29de13feef84425ec-1"></a>./build-kernel.sh grub2
</pre>
<aside class="admonition warning"><p class="admonition-title">Warning</p>
<p><code class="docutils literal">This script only cleans the previous kernel!</code></p>
</aside></section>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/vim-tips-channel/" class="u-url">Vim Tips: Channel</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                mofm
            </span></p>
            <p class="dateline">
            <a href="posts/vim-tips-channel/" rel="bookmark">
            <time class="published dt-published" datetime="2021-12-22T18:32:45+03:00" itemprop="datePublished" title="2021-12-22 18:32">2021-12-22 18:32</time></a>
            </p>
                <p class="commentline">
    
        <a href="posts/vim-tips-channel/#utterances-thread">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <p>Vim supported channels for inter-process communication and job channels communicate with other processes.
Also, The vim packages contains the demo channel server(demoserver.py). You can find <strong>demoserver.py</strong> script in <em>"$VIMRUNTIME/tools/"</em>. <em>"$VIMRUNTIME"</em> path, may change according to your distro:</p>
<p>My path, "/usr/share/vim/vim82/tools/demoserver.py" on Gentoo Linux.</p>
<ul class="simple">
<li><p>First, run the demo server in a terminal.</p></li>
</ul>
<pre class="code bash"><a id="rest_code_3e84228cdf4a4f97b615f54717c7c7ea-1" name="rest_code_3e84228cdf4a4f97b615f54717c7c7ea-1"></a>$ python /usr/share/vim/vim82/tools/demoserver.py
</pre>
<ul>
<li><p>And then, run Vim in another terminal.</p></li>
<li>
<p>For detailed information, I am quoting from the script:</p>
<pre class="literal-block"># Server that will accept connections from a Vim channel.
# Run this server and then in Vim you can open the channel:
#  :let handle = ch_open('localhost:8765')
#
# Then Vim can send requests to the server:
#  :let response = ch_sendexpr(handle, 'hello!')
#
# And you can control Vim by typing a JSON message here, e.g.:
#   ["ex","echo 'hi there'"]
#
# There is no prompt, just type a line and press Enter.
# To exit cleanly type "quit&lt;Enter&gt;".
#
# See ":help channel-demo" in Vim.
#
# This requires Python 2.6 or later.</pre>
</li>
</ul>
</div>
    </article><article class="h-entry post-text" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title"><a href="posts/systemd-boot-update-script/" class="u-url">systemd-boot update script</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn" itemprop="author">
                mofm
            </span></p>
            <p class="dateline">
            <a href="posts/systemd-boot-update-script/" rel="bookmark">
            <time class="published dt-published" datetime="2021-12-19T04:23:45+03:00" itemprop="datePublished" title="2021-12-19 04:23">2021-12-19 04:23</time></a>
            </p>
                <p class="commentline">
    
        <a href="posts/systemd-boot-update-script/#utterances-thread">Comments</a>


        </p>
</div>
    </header><div class="e-content entry-content">
    <p>systemd-boot does not automatically regenerate entry configuration files like update-grup or grub-mkconfig. So you can use below script for Gentoo Linux.</p>
<pre class="code bash"><a id="rest_code_5757f4bb32b142f0a070d48366723c03-1" name="rest_code_5757f4bb32b142f0a070d48366723c03-1"></a><span class="ch">#!/bin/bash</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-2" name="rest_code_5757f4bb32b142f0a070d48366723c03-2"></a><span class="c1">#</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-3" name="rest_code_5757f4bb32b142f0a070d48366723c03-3"></a><span class="c1"># This is a simple kernel hook to populate the systemd-boot entries</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-4" name="rest_code_5757f4bb32b142f0a070d48366723c03-4"></a><span class="c1"># whenever kernels are added or removed.</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-5" name="rest_code_5757f4bb32b142f0a070d48366723c03-5"></a><span class="c1">#</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-6" name="rest_code_5757f4bb32b142f0a070d48366723c03-6"></a>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-7" name="rest_code_5757f4bb32b142f0a070d48366723c03-7"></a><span class="c1"># The UUID of your disk.</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-8" name="rest_code_5757f4bb32b142f0a070d48366723c03-8"></a><span class="c1"># Note: if using LVM, this should be the LVM partition.</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-9" name="rest_code_5757f4bb32b142f0a070d48366723c03-9"></a><span class="nv">UUID</span><span class="o">=</span><span class="s2">"CHANGEME"</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-10" name="rest_code_5757f4bb32b142f0a070d48366723c03-10"></a>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-11" name="rest_code_5757f4bb32b142f0a070d48366723c03-11"></a><span class="c1"># Intel microcode file name</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-12" name="rest_code_5757f4bb32b142f0a070d48366723c03-12"></a><span class="nv">MCODE</span><span class="o">=</span><span class="s2">"CHANGEME"</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-13" name="rest_code_5757f4bb32b142f0a070d48366723c03-13"></a>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-14" name="rest_code_5757f4bb32b142f0a070d48366723c03-14"></a><span class="c1"># Any rootflags you wish to set. For example, mine are currently</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-15" name="rest_code_5757f4bb32b142f0a070d48366723c03-15"></a><span class="c1"># "subvol=@ quiet splash intel_pstate=enable".</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-16" name="rest_code_5757f4bb32b142f0a070d48366723c03-16"></a><span class="nv">ROOTFLAGS</span><span class="o">=</span><span class="s2">"CHANGEME"</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-17" name="rest_code_5757f4bb32b142f0a070d48366723c03-17"></a>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-18" name="rest_code_5757f4bb32b142f0a070d48366723c03-18"></a><span class="c1"># Our kernels.</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-19" name="rest_code_5757f4bb32b142f0a070d48366723c03-19"></a><span class="nv">KERNELS</span><span class="o">=()</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-20" name="rest_code_5757f4bb32b142f0a070d48366723c03-20"></a><span class="nv">FIND</span><span class="o">=</span><span class="s2">"find /boot -maxdepth 1 -name 'vmlinuz-*' -type f -not -name '*.old' -print0 | sort -Vrz"</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-21" name="rest_code_5757f4bb32b142f0a070d48366723c03-21"></a><span class="k">while</span> <span class="nv">IFS</span><span class="o">=</span> <span class="nb">read</span> -r -u3 -d <span class="s1">$'\0'</span> LINE<span class="p">;</span> <span class="k">do</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-22" name="rest_code_5757f4bb32b142f0a070d48366723c03-22"></a>        <span class="nv">KERNEL</span><span class="o">=</span><span class="k">$(</span>basename <span class="s2">"</span><span class="si">${</span><span class="nv">LINE</span><span class="si">}</span><span class="s2">"</span><span class="k">)</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-23" name="rest_code_5757f4bb32b142f0a070d48366723c03-23"></a>        <span class="nv">KERNELS</span><span class="o">+=(</span><span class="s2">"</span><span class="si">${</span><span class="nv">KERNEL</span><span class="p">:</span><span class="nv">8</span><span class="si">}</span><span class="s2">"</span><span class="o">)</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-24" name="rest_code_5757f4bb32b142f0a070d48366723c03-24"></a><span class="k">done</span> <span class="m">3</span>&lt; &lt;<span class="o">(</span><span class="nb">eval</span> <span class="s2">"</span><span class="si">${</span><span class="nv">FIND</span><span class="si">}</span><span class="s2">"</span><span class="o">)</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-25" name="rest_code_5757f4bb32b142f0a070d48366723c03-25"></a>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-26" name="rest_code_5757f4bb32b142f0a070d48366723c03-26"></a><span class="c1"># There has to be at least one kernel.</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-27" name="rest_code_5757f4bb32b142f0a070d48366723c03-27"></a><span class="k">if</span> <span class="o">[</span> <span class="si">${#</span><span class="nv">KERNELS</span><span class="p">[@]</span><span class="si">}</span> -lt <span class="m">1</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-28" name="rest_code_5757f4bb32b142f0a070d48366723c03-28"></a>        <span class="nb">echo</span> -e <span class="s2">"\e[2msystemd-boot\e[0m \e[1;31mNo kernels found.\e[0m"</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-29" name="rest_code_5757f4bb32b142f0a070d48366723c03-29"></a>        <span class="nb">exit</span> <span class="m">1</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-30" name="rest_code_5757f4bb32b142f0a070d48366723c03-30"></a><span class="k">fi</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-31" name="rest_code_5757f4bb32b142f0a070d48366723c03-31"></a>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-32" name="rest_code_5757f4bb32b142f0a070d48366723c03-32"></a><span class="c1"># Copy the latest kernel files to a consistent place so we can</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-33" name="rest_code_5757f4bb32b142f0a070d48366723c03-33"></a><span class="c1"># keep using the same loader configuration.</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-34" name="rest_code_5757f4bb32b142f0a070d48366723c03-34"></a><span class="nv">LATEST</span><span class="o">=</span><span class="s2">"</span><span class="si">${</span><span class="nv">KERNELS</span><span class="p">[@]:</span><span class="nv">0</span><span class="p">:</span><span class="nv">1</span><span class="si">}</span><span class="s2">"</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-35" name="rest_code_5757f4bb32b142f0a070d48366723c03-35"></a><span class="nb">echo</span> -e <span class="s2">"\e[2msystemd-boot\e[0m \e[1;32m</span><span class="si">${</span><span class="nv">LATEST</span><span class="si">}</span><span class="s2">\e[0m"</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-36" name="rest_code_5757f4bb32b142f0a070d48366723c03-36"></a>cat <span class="s">&lt;&lt; EOF &gt; /boot/loader/entries/gentoo.conf</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-37" name="rest_code_5757f4bb32b142f0a070d48366723c03-37"></a><span class="s">title   Gentoo Linux</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-38" name="rest_code_5757f4bb32b142f0a070d48366723c03-38"></a><span class="s">linux   /vmlinuz-${LATEST}</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-39" name="rest_code_5757f4bb32b142f0a070d48366723c03-39"></a><span class="s">initrd  /${MCODE}</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-40" name="rest_code_5757f4bb32b142f0a070d48366723c03-40"></a><span class="s">initrd  /initramfs-${LATEST}.img</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-41" name="rest_code_5757f4bb32b142f0a070d48366723c03-41"></a><span class="s">options root=UUID=${UUID} rw ${ROOTFLAGS}</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-42" name="rest_code_5757f4bb32b142f0a070d48366723c03-42"></a><span class="s">EOF</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-43" name="rest_code_5757f4bb32b142f0a070d48366723c03-43"></a><span class="c1">#done</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-44" name="rest_code_5757f4bb32b142f0a070d48366723c03-44"></a>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-45" name="rest_code_5757f4bb32b142f0a070d48366723c03-45"></a><span class="c1"># Copy any legacy kernels over too, but maintain their version-</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-46" name="rest_code_5757f4bb32b142f0a070d48366723c03-46"></a><span class="c1"># based names to avoid collisions.</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-47" name="rest_code_5757f4bb32b142f0a070d48366723c03-47"></a><span class="k">if</span> <span class="o">[</span> <span class="si">${#</span><span class="nv">KERNELS</span><span class="p">[@]</span><span class="si">}</span> -gt <span class="m">1</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-48" name="rest_code_5757f4bb32b142f0a070d48366723c03-48"></a>        <span class="nv">LEGACY</span><span class="o">=(</span><span class="s2">"</span><span class="si">${</span><span class="nv">KERNELS</span><span class="p">[@]:</span><span class="nv">1</span><span class="si">}</span><span class="s2">"</span><span class="o">)</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-49" name="rest_code_5757f4bb32b142f0a070d48366723c03-49"></a>        <span class="k">for</span> VERSION <span class="k">in</span> <span class="s2">"</span><span class="si">${</span><span class="nv">LEGACY</span><span class="p">[@]</span><span class="si">}</span><span class="s2">"</span><span class="p">;</span> <span class="k">do</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-50" name="rest_code_5757f4bb32b142f0a070d48366723c03-50"></a>            <span class="nb">echo</span> -e <span class="s2">"\e[2msystemd-boot\e[0m \e[1;32m</span><span class="si">${</span><span class="nv">VERSION</span><span class="si">}</span><span class="s2">\e[0m"</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-51" name="rest_code_5757f4bb32b142f0a070d48366723c03-51"></a>            cat <span class="s">&lt;&lt; EOF &gt; /boot/loader/entries/gentoo-${VERSION}.conf</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-52" name="rest_code_5757f4bb32b142f0a070d48366723c03-52"></a><span class="s">title   Gentoo Linux ${VERSION}</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-53" name="rest_code_5757f4bb32b142f0a070d48366723c03-53"></a><span class="s">linux   /vmlinuz-${VERSION}</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-54" name="rest_code_5757f4bb32b142f0a070d48366723c03-54"></a><span class="s">initrd  /${MCODE}</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-55" name="rest_code_5757f4bb32b142f0a070d48366723c03-55"></a><span class="s">initrd  /initramfs-${VERSION}.img</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-56" name="rest_code_5757f4bb32b142f0a070d48366723c03-56"></a><span class="s">options root=UUID=${UUID} rw ${ROOTFLAGS}</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-57" name="rest_code_5757f4bb32b142f0a070d48366723c03-57"></a><span class="s">EOF</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-58" name="rest_code_5757f4bb32b142f0a070d48366723c03-58"></a>        <span class="k">done</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-59" name="rest_code_5757f4bb32b142f0a070d48366723c03-59"></a><span class="k">fi</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-60" name="rest_code_5757f4bb32b142f0a070d48366723c03-60"></a>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-61" name="rest_code_5757f4bb32b142f0a070d48366723c03-61"></a><span class="nb">printf</span> <span class="s2">"\n"</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-62" name="rest_code_5757f4bb32b142f0a070d48366723c03-62"></a><span class="nb">printf</span> <span class="s2">"Updating systemd-boot firmware \n"</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-63" name="rest_code_5757f4bb32b142f0a070d48366723c03-63"></a>bootctl update
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-64" name="rest_code_5757f4bb32b142f0a070d48366723c03-64"></a>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-65" name="rest_code_5757f4bb32b142f0a070d48366723c03-65"></a><span class="c1"># Success!</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-66" name="rest_code_5757f4bb32b142f0a070d48366723c03-66"></a><span class="nb">echo</span> -e <span class="s2">"\e[2m---\e[0m"</span>
<a id="rest_code_5757f4bb32b142f0a070d48366723c03-67" name="rest_code_5757f4bb32b142f0a070d48366723c03-67"></a><span class="nb">exit</span> <span class="m">0</span>
</pre>
<p>This script forked from <a class="reference external" href="https://blobfolio.com/2018/replace-grub2-with-systemd-boot-on-ubuntu-18-04/">here</a>.</p>
    </div>
    </article>
</div>

        <ul class="pager postindexpager clearfix">
<li class="next"><a href="index-24.html" rel="next">Older posts</a></li>
        </ul>
<!--End of body content--><footer id="footer">
            Contents © 2022         <a href="mailto:emre.eryilmaz@piesso.com">mofm</a> - Powered by         <a href="https://getnikola.com" rel="nofollow" target="_blank">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="assets/js/all-nocdn.js"></script><script src="https://polyfill.io/v3/polyfill.js?features=Intl.RelativeTimeFormat.%7Elocale.en"></script><script src="assets/js/luxon.min.js"></script><!-- fancy dates --><script>
        luxon.Settings.defaultLocale = "en";
        fancydates(2, {"preset": false, "format": "yyyy-MM-dd HH:mm"});
        </script><!-- end fancy dates --><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
