<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>hardened .*(nt|log)s? (Posts about kubernetes)</title><link>https://blog.piesso.com/</link><description></description><atom:link href="https://blog.piesso.com/categories/kubernetes.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents Â© 2020 &lt;a href="mailto:emre.eryilmaz@piesso.com"&gt;mofm&lt;/a&gt; 
&lt;a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"&gt;
&lt;img alt="Creative Commons License BY-NC-SA"
style="border-width:0; margin-bottom:12px;"
src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png"&gt;&lt;/a&gt;</copyright><lastBuildDate>Tue, 08 Dec 2020 00:31:28 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Ingress path redirection appends port</title><link>https://blog.piesso.com/posts/ingress-path-redirection-appends-port/</link><dc:creator>mofm</dc:creator><description>&lt;div&gt;&lt;p&gt;Ingress bazi URL isteklerine container port'u ile redirect etmeye calistigi gibi bir sorunla karsilasabilirsiniz. Ornek olarak biraz daha acmak gerekirse;&lt;/p&gt;
&lt;pre class="code bash"&gt;&lt;a name="rest_code_1edb79fee71c4dabae9261e39936d02e-1"&gt;&lt;/a&gt;$ curl -I http://cafe.example.com/coffee/
&lt;a name="rest_code_1edb79fee71c4dabae9261e39936d02e-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_1edb79fee71c4dabae9261e39936d02e-3"&gt;&lt;/a&gt;HTTP/1.1 &lt;span class="m"&gt;200&lt;/span&gt; OK
&lt;a name="rest_code_1edb79fee71c4dabae9261e39936d02e-4"&gt;&lt;/a&gt;Date: Mon, &lt;span class="m"&gt;07&lt;/span&gt; Dec &lt;span class="m"&gt;2020&lt;/span&gt; &lt;span class="m"&gt;23&lt;/span&gt;:47:21 GMT
&lt;a name="rest_code_1edb79fee71c4dabae9261e39936d02e-5"&gt;&lt;/a&gt;Content-Type: text/html
&lt;a name="rest_code_1edb79fee71c4dabae9261e39936d02e-6"&gt;&lt;/a&gt;Content-Length: &lt;span class="m"&gt;87466&lt;/span&gt;
&lt;a name="rest_code_1edb79fee71c4dabae9261e39936d02e-7"&gt;&lt;/a&gt;Connection: keep-alive
&lt;a name="rest_code_1edb79fee71c4dabae9261e39936d02e-8"&gt;&lt;/a&gt;Last-Modified: Mon, &lt;span class="m"&gt;07&lt;/span&gt; Dec &lt;span class="m"&gt;2020&lt;/span&gt; &lt;span class="m"&gt;20&lt;/span&gt;:48:36 GMT
&lt;a name="rest_code_1edb79fee71c4dabae9261e39936d02e-9"&gt;&lt;/a&gt;ETag: &lt;span class="s2"&gt;"5fce9524-155aa"&lt;/span&gt;
&lt;a name="rest_code_1edb79fee71c4dabae9261e39936d02e-10"&gt;&lt;/a&gt;Accept-Ranges: bytes
&lt;/pre&gt;&lt;p&gt;Yukarida goruldugu "&lt;a class="reference external" href="http://cafe.example.com/coffee/"&gt;http://cafe.example.com/coffee/&lt;/a&gt;" adresine gonderdigimiz istek saglikli sekilde "200" kodunu cevap olarak donuyor.
Birde "&lt;a class="reference external" href="http://cafe.example.com/coffee"&gt;http://cafe.example.com/coffee&lt;/a&gt;" seklinde istekte bulunarak test edelim:&lt;/p&gt;
&lt;pre class="code bash"&gt;&lt;a name="rest_code_c93acb8b8de847a284876db166b32ace-1"&gt;&lt;/a&gt;$ curl -I http://cafe.example.com/coffee
&lt;a name="rest_code_c93acb8b8de847a284876db166b32ace-2"&gt;&lt;/a&gt;
&lt;a name="rest_code_c93acb8b8de847a284876db166b32ace-3"&gt;&lt;/a&gt;HTTP/1.1 &lt;span class="m"&gt;301&lt;/span&gt; Moved Permanently
&lt;a name="rest_code_c93acb8b8de847a284876db166b32ace-4"&gt;&lt;/a&gt;Date: Sun, &lt;span class="m"&gt;07&lt;/span&gt; Dec &lt;span class="m"&gt;2020&lt;/span&gt; &lt;span class="m"&gt;23&lt;/span&gt;:52:48 GMT
&lt;a name="rest_code_c93acb8b8de847a284876db166b32ace-5"&gt;&lt;/a&gt;Content-Type: text/html
&lt;a name="rest_code_c93acb8b8de847a284876db166b32ace-6"&gt;&lt;/a&gt;Content-Length: &lt;span class="m"&gt;169&lt;/span&gt;
&lt;a name="rest_code_c93acb8b8de847a284876db166b32ace-7"&gt;&lt;/a&gt;Connection: keep-alive
&lt;a name="rest_code_c93acb8b8de847a284876db166b32ace-8"&gt;&lt;/a&gt;Location: http://cafe.example.com:8080/coffee
&lt;/pre&gt;&lt;p&gt;Bu ornek ise goruldugu gibi "&lt;a class="reference external" href="http://hostname:cointainer_port/paths"&gt;http://hostname:cointainer_port/paths&lt;/a&gt;" seklinde container portunu da ekleyerek sayfayi yanlis sekilde redirect etmeye calisiyor ve sayfa ulasilamaz oluyor.
Buradaki &lt;strong&gt;'8080'&lt;/strong&gt; portu ingress'in arka tarafindaki nginx container'in yayin yapmakta olan portu.&lt;/p&gt;
&lt;p&gt;Sorunun sebebine gelince, bu sorunun ingress ile hic bir alakasi yok. Hem &lt;strong&gt;kubernetes/ingress-nginx&lt;/strong&gt; hem de &lt;strong&gt;nginxinc/nginx-ingress&lt;/strong&gt; ingress controller'larinda nginx konfigurasyonu uzerindeki &lt;a class="reference external" href="http://nginx.org/en/docs/http/ngx_http_core_module.html#port_in_redirect"&gt;port_in_redirect&lt;/a&gt; degeri default olarak 'off' olarak.
Fakat arka tarafta calisan nginx container uzerindeki bu konfigurasyonu '&lt;em&gt;on&lt;/em&gt;' yapilmissa bu durumla karsilasabilirsiniz. Bunu nginx.conf uzerinde '&lt;em&gt;port_in_redirect off;&lt;/em&gt;' seklinde kapatarak yasanmasini engelleyebilirsiniz.&lt;/p&gt;
&lt;p&gt;Asagidaki sekilde nginx.conf'u configmap'e ekleyerek nginx pod'un bu configmap'i kullanmasini saglayarak deployment yapabilirsiniz.&lt;/p&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-1"&gt;&lt;/a&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-2"&gt;&lt;/a&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ConfigMap&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-3"&gt;&lt;/a&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-4"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;nginx-conf&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-5"&gt;&lt;/a&gt;&lt;span class="nt"&gt;data&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-6"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;nginx.conf&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="p p-Indicator"&gt;|&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-7"&gt;&lt;/a&gt;    &lt;span class="no"&gt;worker_processes  1;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-8"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-9"&gt;&lt;/a&gt;    &lt;span class="no"&gt;error_log  /var/log/nginx/error.log warn;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-10"&gt;&lt;/a&gt;    &lt;span class="no"&gt;pid        /tmp/nginx.pid;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-11"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-12"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-13"&gt;&lt;/a&gt;    &lt;span class="no"&gt;events {&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-14"&gt;&lt;/a&gt;        &lt;span class="no"&gt;worker_connections  1024;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-15"&gt;&lt;/a&gt;    &lt;span class="no"&gt;}&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-16"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-17"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-18"&gt;&lt;/a&gt;    &lt;span class="no"&gt;http {&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-19"&gt;&lt;/a&gt;        &lt;span class="no"&gt;proxy_temp_path /tmp/proxy_temp;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-20"&gt;&lt;/a&gt;        &lt;span class="no"&gt;client_body_temp_path /tmp/client_temp;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-21"&gt;&lt;/a&gt;        &lt;span class="no"&gt;fastcgi_temp_path /tmp/fastcgi_temp;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-22"&gt;&lt;/a&gt;        &lt;span class="no"&gt;uwsgi_temp_path /tmp/uwsgi_temp;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-23"&gt;&lt;/a&gt;        &lt;span class="no"&gt;scgi_temp_path /tmp/scgi_temp;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-24"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-25"&gt;&lt;/a&gt;        &lt;span class="no"&gt;include       /etc/nginx/mime.types;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-26"&gt;&lt;/a&gt;        &lt;span class="no"&gt;default_type  application/octet-stream;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-27"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-28"&gt;&lt;/a&gt;        &lt;span class="no"&gt;log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-29"&gt;&lt;/a&gt;                          &lt;span class="no"&gt;'$status $body_bytes_sent "$http_referer" '&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-30"&gt;&lt;/a&gt;                          &lt;span class="no"&gt;'"$http_user_agent" "$http_x_forwarded_for"';&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-31"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-32"&gt;&lt;/a&gt;        &lt;span class="no"&gt;access_log  /var/log/nginx/access.log  main;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-33"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-34"&gt;&lt;/a&gt;        &lt;span class="no"&gt;sendfile        on;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-35"&gt;&lt;/a&gt;        &lt;span class="no"&gt;#tcp_nopush     on;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-36"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-37"&gt;&lt;/a&gt;        &lt;span class="no"&gt;port_in_redirect off;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-38"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-39"&gt;&lt;/a&gt;        &lt;span class="no"&gt;keepalive_timeout  65;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-40"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-41"&gt;&lt;/a&gt;        &lt;span class="no"&gt;#gzip  on;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-42"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-43"&gt;&lt;/a&gt;        &lt;span class="no"&gt;include /etc/nginx/conf.d/*.conf;&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-44"&gt;&lt;/a&gt;    &lt;span class="no"&gt;}&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-45"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-46"&gt;&lt;/a&gt;&lt;span class="nn"&gt;---&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-47"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-48"&gt;&lt;/a&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;apps/v1&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-49"&gt;&lt;/a&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Deployment&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-50"&gt;&lt;/a&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-51"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;coffee&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-52"&gt;&lt;/a&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-53"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;replicas&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;3&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-54"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-55"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;matchLabels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-56"&gt;&lt;/a&gt;      &lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;coffee&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-57"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-58"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-59"&gt;&lt;/a&gt;      &lt;span class="nt"&gt;labels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-60"&gt;&lt;/a&gt;        &lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;coffee&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-61"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-62"&gt;&lt;/a&gt;      &lt;span class="nt"&gt;containers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-63"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;www&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-64"&gt;&lt;/a&gt;        &lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;nginxinc/nginx-unprivileged&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-65"&gt;&lt;/a&gt;        &lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-66"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;containerPort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;8080&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-67"&gt;&lt;/a&gt;        &lt;span class="nt"&gt;volumeMounts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-68"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;nginx-conf&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-69"&gt;&lt;/a&gt;          &lt;span class="nt"&gt;mountPath&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;/etc/nginx/nginx.conf&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-70"&gt;&lt;/a&gt;          &lt;span class="nt"&gt;subPath&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;nginx.conf&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-71"&gt;&lt;/a&gt;          &lt;span class="nt"&gt;readOnly&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;true&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-72"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-73"&gt;&lt;/a&gt;&lt;span class="nn"&gt;---&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-74"&gt;&lt;/a&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-75"&gt;&lt;/a&gt;&lt;span class="nn"&gt;---&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-76"&gt;&lt;/a&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-77"&gt;&lt;/a&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Service&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-78"&gt;&lt;/a&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-79"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;coffee-svc&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-80"&gt;&lt;/a&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-81"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-82"&gt;&lt;/a&gt;  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;80&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-83"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;targetPort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;8080&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-84"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;protocol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;TCP&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-85"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;http&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-86"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_e62f03e73f8344e0b8eea3bdd8fe5976-87"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;coffee&lt;/span&gt;
&lt;/pre&gt;&lt;/div&gt;</description><category>ingress</category><category>kubernetes</category><guid>https://blog.piesso.com/posts/ingress-path-redirection-appends-port/</guid><pubDate>Mon, 07 Dec 2020 23:29:14 GMT</pubDate></item><item><title>Kubernetes, Static Website, Git</title><link>https://blog.piesso.com/posts/kubernetes-static-website-git/</link><dc:creator>mofm</dc:creator><description>&lt;div&gt;&lt;p&gt;Uzun bir aradan sonra Kubernetes ile ilgili bir konu ile yazilara basliyoruz. Bu yazida Kubernetes nedir? Ne degildir? gibi Kubernetes 101'den bahsetmek yerine bir senaryo ile ilgili sizlere fikir vermek istedim. Hemen kisaca senaryodan bahsedelim:&lt;/p&gt;
&lt;div class="section" id="senaryo"&gt;
&lt;h2&gt;Senaryo:&lt;/h2&gt;
&lt;p&gt;Gunumuzde insanlar blog yazilarini yayinlamak icin static websites generator'lardan(nikola, jekyll, hugo vb.) birini kullanmaya yoneliyor. Daha onceden siklikla Wordpress kullanilirken artik bu sekilde bir cozum kullanimin farkli sebepleri olabilir. Bunu simdilik irdelemeyecegim.
Bu senaryomuzda yukarda bahsettigimiz sekilde olusturdugunuz static websitenizi &lt;em&gt;"Kubernetes uzerine git ile nasil otomatik update edebiliriz?"&lt;/em&gt; cozumu hakkinda fikir verecegim.
Senaryo semasinin ayrintilari asagidaki gibidir:&lt;/p&gt;
&lt;img alt="/images/k8s-web-git.png" src="https://blog.piesso.com/images/k8s-web-git.png"&gt;
&lt;p&gt;Senaryoyu biraz daha ayrintilandirmak gerekirse, en alt katmandan en uste dogru cikalim. Bu senaryo icin volume olarak node uzerindeki &lt;a class="reference external" href="https://kubernetes.io/docs/concepts/storage/volumes/#local"&gt;Local&lt;/a&gt; diski kullandim. Bu production icin uygun olmasa da test ortamini olusturmak ve iki container'in ayni volume'u kullanabilmesi icin bunu sectim.&lt;/p&gt;
&lt;div class="admonition warning"&gt;
&lt;p class="admonition-title"&gt;Warning&lt;/p&gt;
&lt;p&gt;Production ortaminda kesinlikle local disk kullanmayin! Siz production ortamlariniz icin herhangi bir &lt;em&gt;Clustered File System&lt;/em&gt; kullanabilirsiniz.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="persistentvolume-ve-persistentvolumeclaim-olusturulmasi"&gt;
&lt;h3&gt;PersistentVolume ve PersistentVolumeClaim Olusturulmasi:&lt;/h3&gt;
&lt;p&gt;Burada bir noktaya deginmek gerekirse olusturacagimiz bu volume'u nginx container'i icin sadece readonly mount ederken git-sync icin ise hem read hem de write olacak sekilde mount edecegiz. git-sync belirledigimiz git reposunu buraya sync edecektir. Bu yuzden hem read hem write yetkisi gerekirken, nginx sadece sayfalari yayinlayacagi icin read yetkisi yeterlidir.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;PersistentVolume:&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-1"&gt;&lt;/a&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-2"&gt;&lt;/a&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;PersistentVolume&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-3"&gt;&lt;/a&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-4"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;my-local-pv-01&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-5"&gt;&lt;/a&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-6"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;capacity&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-7"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;storage&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1Gi&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-8"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;accessModes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-9"&gt;&lt;/a&gt;  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ReadWriteOnce&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-10"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;persistentVolumeReclaimPolicy&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Delete&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-11"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;storageClassName&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;my-local-storage&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-12"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;local&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-13"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;path&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;/mnt/disk1/vol1&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-14"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;nodeAffinity&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-15"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;required&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-16"&gt;&lt;/a&gt;      &lt;span class="nt"&gt;nodeSelectorTerms&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-17"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;matchExpressions&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-18"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;key&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;kubernetes.io/hostname&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-19"&gt;&lt;/a&gt;          &lt;span class="nt"&gt;operator&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;In&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-20"&gt;&lt;/a&gt;          &lt;span class="nt"&gt;values&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_4d3a1d6da41a48bd9bb003db23f560b3-21"&gt;&lt;/a&gt;          &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;node3&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;Yukardaki sekilde sadece &lt;em&gt;node3&lt;/em&gt; hostname'li node uzerindeki '/mnt/disk1/vol1/' uzerinde 1GB buyuklugunde persistentVolume olusturduk. Yukarida da belirttigim gibi kesinlikle production ortaminda local disk kullanmayin!&lt;/p&gt;
&lt;pre class="code bash"&gt;&lt;a name="rest_code_8010fe3d51ce40fbbfaa837bfbea50fc-1"&gt;&lt;/a&gt;$ kubectl apply -f pv.yaml
&lt;/pre&gt;&lt;p&gt;persistentVolume olusturtuktan sonra persistentVolumeClaim olusturalim.( "pv ve pvc nedir?" merak ediyorsaniz &lt;a class="reference external" href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/"&gt;buradan&lt;/a&gt; )&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;PersistentVolumeClaim:&lt;/strong&gt;&lt;/p&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_0a794df069734d118aafecb65868b9b3-1"&gt;&lt;/a&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;PersistentVolumeClaim&lt;/span&gt;
&lt;a name="rest_code_0a794df069734d118aafecb65868b9b3-2"&gt;&lt;/a&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;a name="rest_code_0a794df069734d118aafecb65868b9b3-3"&gt;&lt;/a&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_0a794df069734d118aafecb65868b9b3-4"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;my-claim-01&lt;/span&gt;
&lt;a name="rest_code_0a794df069734d118aafecb65868b9b3-5"&gt;&lt;/a&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_0a794df069734d118aafecb65868b9b3-6"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;accessModes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_0a794df069734d118aafecb65868b9b3-7"&gt;&lt;/a&gt;  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;ReadWriteOnce&lt;/span&gt;
&lt;a name="rest_code_0a794df069734d118aafecb65868b9b3-8"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;storageClassName&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;my-local-storage&lt;/span&gt;
&lt;a name="rest_code_0a794df069734d118aafecb65868b9b3-9"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;resources&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_0a794df069734d118aafecb65868b9b3-10"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;requests&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_0a794df069734d118aafecb65868b9b3-11"&gt;&lt;/a&gt;      &lt;span class="nt"&gt;storage&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1Gi&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code bash"&gt;&lt;a name="rest_code_e43ab8f65a91415188f503e032bb84fd-1"&gt;&lt;/a&gt;$ kubectl apply -f pvc.yaml
&lt;/pre&gt;&lt;p&gt;Volume olusturdugumuza gore artik yayinlayacagimiz static websitesi icin deployment asamasina gecebiliriz.&lt;/p&gt;
&lt;/div&gt;
&lt;div class="section" id="deployment"&gt;
&lt;h3&gt;Deployment:&lt;/h3&gt;
&lt;p&gt;Asagidaki sekilde deployment olusturalim:&lt;/p&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-1"&gt;&lt;/a&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;apps/v1&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-2"&gt;&lt;/a&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Deployment&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-3"&gt;&lt;/a&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-4"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;blog&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-5"&gt;&lt;/a&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-6"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;replicas&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;1&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-7"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-8"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;matchLabels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-9"&gt;&lt;/a&gt;      &lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;blog&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-10"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;template&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-11"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-12"&gt;&lt;/a&gt;      &lt;span class="nt"&gt;labels&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-13"&gt;&lt;/a&gt;        &lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;blog&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-14"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-15"&gt;&lt;/a&gt;      &lt;span class="nt"&gt;containers&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-16"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;git-sync&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-17"&gt;&lt;/a&gt;        &lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;k8s.gcr.io/git-sync/git-sync:v3.2.0&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-18"&gt;&lt;/a&gt;        &lt;span class="nt"&gt;volumeMounts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-19"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;www-persistent-storage&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-20"&gt;&lt;/a&gt;          &lt;span class="nt"&gt;mountPath&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;/tmp/git&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-21"&gt;&lt;/a&gt;        &lt;span class="nt"&gt;env&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-22"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;GIT_SYNC_REPO&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-23"&gt;&lt;/a&gt;          &lt;span class="nt"&gt;value&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;https://github.com/user_name/blog.example.com.git&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-24"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;GIT_SYNC_DEST&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-25"&gt;&lt;/a&gt;          &lt;span class="nt"&gt;value&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;"blog"&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-26"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;GIT_SYNC_WAIT&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-27"&gt;&lt;/a&gt;          &lt;span class="nt"&gt;value&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="s"&gt;"10"&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-28"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;www&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-29"&gt;&lt;/a&gt;        &lt;span class="nt"&gt;image&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;nginxinc/nginx-unprivileged&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-30"&gt;&lt;/a&gt;        &lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-31"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;containerPort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;8080&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-32"&gt;&lt;/a&gt;        &lt;span class="nt"&gt;volumeMounts&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-33"&gt;&lt;/a&gt;        &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;www-persistent-storage&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-34"&gt;&lt;/a&gt;          &lt;span class="nt"&gt;mountPath&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;/usr/share/nginx/html&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-35"&gt;&lt;/a&gt;          &lt;span class="nt"&gt;readOnly&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;true&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-36"&gt;&lt;/a&gt;      &lt;span class="nt"&gt;volumes&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-37"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;www-persistent-storage&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-38"&gt;&lt;/a&gt;        &lt;span class="nt"&gt;persistentVolumeClaim&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-39"&gt;&lt;/a&gt;          &lt;span class="nt"&gt;claimName&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;my-claim-01&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-40"&gt;&lt;/a&gt;      &lt;span class="nt"&gt;nodeSelector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-41"&gt;&lt;/a&gt;        &lt;span class="nt"&gt;kubernetes.io/hostname&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;node3&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-42"&gt;&lt;/a&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-43"&gt;&lt;/a&gt;&lt;span class="nn"&gt;---&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-44"&gt;&lt;/a&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;v1&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-45"&gt;&lt;/a&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Service&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-46"&gt;&lt;/a&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-47"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;blog-svc&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-48"&gt;&lt;/a&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-49"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;ports&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-50"&gt;&lt;/a&gt;  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;port&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;80&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-51"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;targetPort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;8080&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-52"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;protocol&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;TCP&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-53"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;http&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-54"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;selector&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_abc2c532c7ca447985bbeb53b7138b6c-55"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;app&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;blog&lt;/span&gt;
&lt;/pre&gt;&lt;p&gt;git-sync environment degerlerinden GIT_SYNC_REPO yerine git reponuzu ve GIT_SYNC_DEST degerini isteginize gore degistirebilirsiniz.&lt;/p&gt;
&lt;pre class="code bash"&gt;&lt;a name="rest_code_65bc2669cba34119bac20d02e68ddd97-1"&gt;&lt;/a&gt;$ kubectl apply -f deployment.yaml
&lt;/pre&gt;&lt;p&gt;Deployment olusturulup tamamlandiktan sonra websitemizi yayinlamak icin ingress olusturabiliriz.&lt;/p&gt;
&lt;pre class="code yaml"&gt;&lt;a name="rest_code_07d25846c04645d79f44089bd76155de-1"&gt;&lt;/a&gt;&lt;span class="nt"&gt;apiVersion&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;networking.k8s.io/v1beta1&lt;/span&gt;
&lt;a name="rest_code_07d25846c04645d79f44089bd76155de-2"&gt;&lt;/a&gt;&lt;span class="nt"&gt;kind&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;Ingress&lt;/span&gt;
&lt;a name="rest_code_07d25846c04645d79f44089bd76155de-3"&gt;&lt;/a&gt;&lt;span class="nt"&gt;metadata&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_07d25846c04645d79f44089bd76155de-4"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;name&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;blog-ingress&lt;/span&gt;
&lt;a name="rest_code_07d25846c04645d79f44089bd76155de-5"&gt;&lt;/a&gt;&lt;span class="nt"&gt;spec&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_07d25846c04645d79f44089bd76155de-6"&gt;&lt;/a&gt;        &lt;span class="c1"&gt;#  ingressClassName: nginx # use only with k8s version &amp;gt;= 1.18.0&lt;/span&gt;
&lt;a name="rest_code_07d25846c04645d79f44089bd76155de-7"&gt;&lt;/a&gt;  &lt;span class="nt"&gt;rules&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_07d25846c04645d79f44089bd76155de-8"&gt;&lt;/a&gt;  &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;host&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;blog.example.com&lt;/span&gt;
&lt;a name="rest_code_07d25846c04645d79f44089bd76155de-9"&gt;&lt;/a&gt;    &lt;span class="nt"&gt;http&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_07d25846c04645d79f44089bd76155de-10"&gt;&lt;/a&gt;      &lt;span class="nt"&gt;paths&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_07d25846c04645d79f44089bd76155de-11"&gt;&lt;/a&gt;      &lt;span class="p p-Indicator"&gt;-&lt;/span&gt; &lt;span class="nt"&gt;path&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;/blog&lt;/span&gt;
&lt;a name="rest_code_07d25846c04645d79f44089bd76155de-12"&gt;&lt;/a&gt;        &lt;span class="nt"&gt;backend&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt;
&lt;a name="rest_code_07d25846c04645d79f44089bd76155de-13"&gt;&lt;/a&gt;          &lt;span class="nt"&gt;serviceName&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;blog-svc&lt;/span&gt;
&lt;a name="rest_code_07d25846c04645d79f44089bd76155de-14"&gt;&lt;/a&gt;          &lt;span class="nt"&gt;servicePort&lt;/span&gt;&lt;span class="p"&gt;:&lt;/span&gt; &lt;span class="l l-Scalar l-Scalar-Plain"&gt;80&lt;/span&gt;
&lt;/pre&gt;&lt;pre class="code bash"&gt;&lt;a name="rest_code_45685fe9ebce466890922eb719d16631-1"&gt;&lt;/a&gt;$ kubectl apply -f ingress.yaml
&lt;/pre&gt;&lt;p&gt;ingress tanimlamamiz da yapildigina gore &lt;em&gt;http://blog.example.com/blog&lt;/em&gt; adresinden websitemize ulasabiliriz. Artik git uzerine sayfalarinizi push'ladiktan sonra sayfaniz otomatik guncellenecektir. Umarim size fikir vermistir.&lt;/p&gt;
&lt;/div&gt;
&lt;/div&gt;&lt;/div&gt;</description><category>git</category><category>kubernetes</category><category>static websites</category><guid>https://blog.piesso.com/posts/kubernetes-static-website-git/</guid><pubDate>Sat, 05 Dec 2020 15:12:03 GMT</pubDate></item></channel></rss>